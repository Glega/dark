
var data = "";//'{"input_nodes":17,"hidden_nodes":18,"output_nodes":9,"weights_ih":{"rows":18,"cols":17,"data":[[-2.180334678578229,0.1591142868420321,-3.3518595602867474,-1.3288262634739225,0.2330684387978479,1.1541589946407158,-0.9408580197085585,-1.1846979519408256,2.39226295715308,0.2126365883080894,0.6454051423583717,2.055034008314588,-0.8210860221478613,2.035774341619932,-4.295936811523729,0.2178472938843482,0.09455204172861076],[-3.3837455686613813,3.8812931261067027,-2.875134637843175,2.1531144663587467,0.0798417200592012,1.5053368028472671,2.9739660492170534,-0.4454687322849792,1.9280905942878368,2.9250892823077814,-0.3954972223545014,-0.6695975507405552,-0.6732579792262505,0.13103568575409638,0.7783352564108788,-1.3191915742760694,-0.8933683445358858],[-0.36466713607363194,5.077465338802537,-0.3728124475583129,-0.41460887663963003,-0.9258452164275061,0.39525635647991053,-1.4358532074314945,-2.6193148231633603,1.0995175961664652,0.7480254280209981,-1.670837475722817,-1.366504550917233,-2.077833811963199,2.678640254258555,-0.4392924531202367,-0.01885469805210982,0.16949474013915666],[-4.544169809719255,-0.8286806180994729,0.20814595548003906,4.976115682183169,3.1757648003949246,2.529369186068274,-0.8510407464234783,0.48003728274398055,-1.1426625403875796,-0.3440970785549282,1.1307220277383598,-1.0540582006790213,0.7709017086706478,-0.7297848240562166,-1.43863600042759,-2.161522171159942,3.3724791169714585],[-1.8474258375206478,-0.12562163213677058,0.5434488092365513,0.24127574383757072,-2.009814277311847,-1.2948569873475289,0.11478961187703021,-2.385398597609366,-1.0886077839541561,0.3401399222043587,-0.860704725836566,2.644117810775834,2.589362759259414,-0.4544171956619909,-0.5028847686560942,1.069396854661008,2.1423394210550852],[-0.01196025939319112,-1.530843150332399,-2.926554890183277,1.488228852062164,-0.8032157275641143,0.11961168027345723,-0.09735744206593658,0.13250727566625242,-1.0928404006773929,-1.9505163970185975,1.0918187351195106,-0.47618951275420507,3.3335340959112774,-1.7453439973815734,2.257871754740422,0.6153925044988509,1.2149783485020889],[0.6521586690775574,-1.889390608288302,-1.9006899790561653,-2.009559748671212,-0.2304475778600399,3.2117212061603495,-0.07355292936955973,0.7881521397552516,-1.5372548075686485,0.4348548035228622,0.4491967574409954,-0.6784026284737654,0.06995224936113972,-1.3952866741078989,0.6817164457372002,0.04533318380214202,0.03350855628687835],[2.6366946417038717,0.06036604578983773,0.806330348612171,0.9005496683892108,-4.363440568383991,2.224867971181955,-2.3291744571768787,3.62067977658928,-3.2737537692569885,3.2743481767217504,-0.5174229464602468,-2.749954676425612,-3.4124414511837435,-3.6841500605032085,1.8665576144472964,0.6056997197704319,0.8107971154433888],[-0.8287331398896065,-2.0778861831478617,2.0332482812868657,2.30074214242718,0.07137928433630747,0.45700068387421355,-0.2849172917215226,-2.3222901446320945,-0.01853344019099243,-0.008299594934439408,-1.0576826872780898,-3.094748205363725,-0.42080518353563845,0.11100843361537033,1.3995516286932552,-0.7326954175320133,-0.04337091387350267],[2.327125851682773,-2.3064666306170083,-1.578473162252875,-1.2385443172120851,-0.022352046518348573,-0.7541691483760717,-0.9381253691786293,-2.5477867778113397,-0.7423961615463673,0.6863169430693186,-0.8252628291035256,0.7478728592515739,-3.611062839527022,-0.5604775943288871,1.327045566126277,-0.6922804550833372,-3.55351878651527],[-1.8791397108435957,1.5362091830438007,-0.36295687151284495,-0.3281820942740913,-1.692940162945297,-0.484173048403194,0.7297563867308273,1.7168198928384735,-3.5329059474154656,2.1362588048172353,1.6882143788605724,-1.9556704029178564,0.5240657799371637,2.7379999264246306,0.9926752129022565,-0.15417351113675354,-1.996904633296335],[2.794308020446719,1.659826630052113,3.716717121002873,-1.0206144022340657,1.738828153700427,-0.4597499919050789,2.1137547514346657,0.015322688350419389,1.5156256960802703,1.2726108153020594,0.6987472085608163,0.043376613492964955,-2.3217365637879612,1.1430873023673531,0.16690412081673922,1.0618690938272022,-4.660311979432859],[-1.924247396927893,0.7969294148386742,-3.013776745656576,-0.6762290830052499,-2.612842697919214,1.0292273333183404,-1.4388262502804334,-0.4864851026105812,0.1163225964916928,-1.3941123554061157,1.0557134000053403,4.453115759058966,-0.07699589151285668,0.5444987137807715,-1.463468593984055,0.44212032669052526,2.2338970551512722],[3.4779873749604215,-2.4209204305527696,0.09284565037432235,-1.1509503543766904,-1.6903963540650777,-1.3210231462853232,2.0188581830571835,2.0316415004477184,-0.5191567397008183,-1.67792402663666,-1.6144631493147086,-1.7097407390240833,-2.2560122801428415,1.2589840829361874,-1.6671992472997403,0.26314956021484776,0.26015430032038256],[-0.46577560012076774,0.9422969135099969,0.9600729559488251,2.2816656495513965,-0.33192438099373767,0.9137784834339693,-1.1281632391110876,1.1950731805916175,0.6108412784836835,1.495777273753763,-0.3158706169897712,1.8379716781405802,-0.28671348648207906,1.84685806276008,-1.9212012650798773,2.0469717251670243,0.5224335028886136],[2.15231668367678,1.2030610678610274,-1.5772808011414905,3.7033820909655035,-1.4671984584874882,0.3972015386606026,1.5346030774568296,-1.7811629275091825,-2.960389251015112,-1.3542790145002161,0.26470830766095904,3.857009077156074,-2.469211616735835,0.6386947584643603,0.18929908892791153,-0.6325884665254606,0.2275309875267253],[-2.371748797843477,-0.7673765850685067,1.2240538475924927,-0.7477060922761828,0.07724780544078225,1.7655452289860372,-2.3594620428258644,0.30699676171865986,-0.5876318616179741,-0.7418657863340478,1.1108772929232094,-0.12215195634426723,1.5213519387119847,-1.529872022255241,-0.47841671446428574,1.014045394309124,-0.6044045607735186],[-5.767965268862734,0.22542622362508768,-4.004687042268658,-2.3270555731220046,0.23821798284884377,-2.5735278336147456,-1.8465181621069435,-2.6035731659892773,3.1806387004455035,3.6494254738627787,4.668317794415023,-1.3628938027670245,0.6935991943670442,-1.339001903045365,0.5547231089900969,-2.6820821292806603,-2.0469249392490183]]},"weights_ho":{"rows":9,"cols":18,"data":[[0.9100246631381136,3.1620595271364698,0.7773273292691595,-1.2504428616123309,1.7034436799462152,-0.7277975625997236,0.9893993794724727,3.8655927619021613,-1.4026425734284242,-0.9322157544630244,0.31486850451433246,-0.4761539548029312,0.10572476846327117,0.7696739816543633,0.5753656526021828,-3.213018929111285,0.8741707716034475,0.7942459754290795],[3.4545272702550935,0.9048125765478173,-2.700104506135963,0.09696604422365673,1.029402800289682,-2.5036270044836053,-2.134506033578899,-0.3484647825803383,-2.6854285418975783,0.6608111887200002,-0.7786080987455315,2.1356262295490964,2.830442962688576,-2.315979006935639,1.822333745724268,-0.6074279332205607,0.30188563258929696,1.1717017554091917],[-0.15661644498794963,0.8222237411083182,0.9692003918381006,0.10722036441530847,0.8228099600636125,-0.07880044749187698,1.2713928682410511,-0.42185409299894605,1.8058612981301267,2.2226425372883307,-0.19218953437710118,3.021294295849151,1.134774850747606,-0.06201360959198038,0.3581770131208705,2.5175186568908328,-1.7061185595503094,0.5066969617177259],[2.8842159972783734,-2.905966909485714,-3.041879761918632,-1.0569482158608148,2.546711144204269,-2.8050431107207134,-1.0583632274088235,-3.0910895786107484,2.0088155352866663,-0.24165429178977788,-0.6116782260335025,0.8700820659228243,1.308686457551961,-2.614020441889605,-0.28356715697313184,0.45212931086289226,-1.3054852842632536,0.9087334220018594],[-3.998156242010727,0.1475618187512282,0.758796081919921,-2.5943066053068877,-0.27664674167267134,3.792582418710706,0.8235881544003963,0.03641910625680522,-1.636305872402315,-2.0025718421250462,2.9281207104232574,-1.8382464607947624,2.187510404266561,1.0332873498540907,1.3355868747001416,2.969135275993406,-2.125301657644868,-2.1739216321270503],[-1.0545045823598356,0.5253075227697608,-0.6249754178531685,-4.178320613823886,-0.6185357188501833,-0.4782847368281872,-0.3610856517783581,0.2241108831727463,0.17123380493793447,1.0828505315746126,0.12109676950808948,-0.5525222963275787,0.3653458975756828,1.4254751500734177,-2.251828492563288,1.6147062506415195,1.5040910152880347,-0.184724844616258],[-0.6213807388752053,1.8664279160127333,-0.46411350278207997,2.478243677444269,0.38486938969920415,-1.4757236111626388,-1.0041950550154684,3.528406097910815,-1.016382776770377,0.5331789118353559,-5.642794264643638,-3.4615904747196407,-0.4769512467193864,1.8477023298468283,0.6331147721639058,-1.0381884574128826,-2.1291492689016547,-0.7576142437916809],[2.0739452046205367,0.05163645143447543,1.0982300682642603,-2.0073531944339242,-1.3597610516002028,-0.028608537350826968,-2.1249544853113065,-3.6170494046981996,0.30874745580496027,-0.864209618050666,-0.5677493906976012,-1.1168080628243233,-0.09737180379280352,0.9932348045210903,-1.3894638126085528,-2.1511822029231324,1.3519071895361119,-1.030967514786007],[1.9647715174854077,0.46357078701096033,2.5744446168281963,1.7670982741738985,0.9875445844253935,-2.6098924024074917,-2.036505265535688,3.7030195386809273,1.53957053084854,0.6602863159233358,-1.691096225698032,0.5129604473556659,1.961570455982025,-1.1350400455330696,1.8710401209329772,-4.786558215684888,-1.0076843770955628,2.003858831077496]]},"bias_h":{"rows":18,"cols":1,"data":[[1.1531394415613594],[-2.969183293271528],[-0.6643221509529826],[2.609894080510382],[1.631290312299861],[0.20625111156410222],[0.9481563189886347],[0.2422329341363938],[-2.0152765483833157],[1.4885692626490843],[1.9050073890799828],[-1.1753334174418406],[-2.4342377251915495],[2.9160011089128863],[-0.8648876946802222],[2.9886608895635174],[2.6803594964398756],[1.1503853062432734]]},"bias_o":{"rows":9,"cols":1,"data":[[-1.519687317712863],[1.2112405488490672],[0.9891347310677914],[-2.0347544763260226],[-2.2867065239878945],[-1.9399239770876942],[-1.829851318143823],[0.020324061740509936],[-0.43107758979167266]]},"learning_rate":0.1,"activation_function":{}}';
var brain = new Ai("sdsd");//null;//NeuralNetwork.deserialize(data);


var table = [0,0,0,0,0,0,0,0,0];
var turns = [1,1,1,1,1,1,1,1,1];
var round = 0;
var currentPlayer = 0;


function getCellPosition(pos){
   var unitposition = Math.floor((pos - 1) / 3);
   var posX = pos - 3 * unitposition;
   posX = posX - 1;
   //console.log(posX + " - pos x" + " pos y = " + unitposition);
   return unitposition.toString() + "_" + posX.toString();
}

function restart(){
	table = [0,0,0,0,0,0,0,0,0];
    turns = [1,1,1,1,1,1,1,1,1];
	round = 0;
	for(var i = 0; i < 3; i++){
		for(var j = 0; j < 3; j++){
			var tr = document.getElementById(i + "_" + j);
			tr.innerHTML = "";
			
		}
	}
	
	if(Math.random() < 0.2){
		currentPlayer = 1;
		think();
	}
	
}

function turn(cell){
	
	if(brain == null){
		alert("Мозги не найдены");
		return;
	}
	
	if(table[cell] != 0){return;}
	var id = getCellPosition(cell + 1);
	console.log(id);
	
	turns[cell] = 0;
	round++;
	var tr = document.getElementById(id);
	
	if(currentPlayer == 0){
		tr.innerHTML = "X";
		table[cell] = 1;
		currentPlayer = 1;
		think();
		return;
	}else{
		table[cell] = -1;
		tr.innerHTML = "O";
		currentPlayer = 0;
	}
	
	
	
}

function think(){
	
	turn(brain.think(table, turns));
	return;
	
	var inputs = [];
	var s = 0;
	for(var i = 0; i < table.length; i++){
		s = 0;
		if(table[i] > 0) s = 0.5;
		if(table[i] < 0) s = 0.7;
		if(table[i] == 0) s = 1;
		inputs.push(s);
    }
	
	var hor1 = table[0] + table[1] + table[2];
	var hor2 = table[3] + table[4] + table[5];
	var hor3 = table[6] + table[7] + table[8];
		  
	var ver1 = table[0] + table[3] + table[6];
	var ver2 = table[1] + table[4] + table[7];
	var ver3 = table[2] + table[5] + table[8];
		  
	var dig1 = table[0] + table[4] + table[8];
	var dig2 = table[2] + table[4] + table[6];
	
	var firstTurn = Math.random();
	
	if(round > 1) firstTurn = 0;
	
	console.log(firstTurn);
	
	inputs = inputs.concat([hor1, hor2, hor3, ver1, ver2, ver3, dig1, dig2, firstTurn]);
	
	var action = this.brain.predict(inputs);
    var maxI = 0;
    var maxValue = 0;

    for(var i = 0; i < action.length; i++){
		action[i] *= turns[i];
        if(action[i] > maxValue){
            maxI = i;
            maxValue = action[i];
        }
    }
	
	turn(maxI);
	
}

function createBrain(){
	var data = document.getElementById('scriptText');
	brain = NeuralNetwork.deserialize(data.value);
}


function userClick(element){
	//console.log(element.id);
	var s = element.id.split("_");
	var posX = parseInt(s[0]);
	var posY = parseInt(s[1]);
	
	var pos = posX * 3 + posY;
	//console.log(pos);
	turn(pos);
	
}